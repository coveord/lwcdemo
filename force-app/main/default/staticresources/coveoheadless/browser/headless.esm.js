function e(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function t(e){return!!e&&!!e[N]}function r(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[U]||!!e.constructor[U]||c(e)||u(e))}function n(e,t,r){void 0===r&&(r=!1),0===o(e)?(r?Object.keys:B)(e).forEach((function(n){r&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(r,n){return t(n,r,e)}))}function o(e){var t=e[N];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:c(e)?2:u(e)?3:0}function i(e,t){return 2===o(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function a(e,t,r){var n=o(e);2===n?e.set(t,r):3===n?(e.delete(t),e.add(r)):e[t]=r}function s(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function c(e){return F&&e instanceof Map}function u(e){return V&&e instanceof Set}function l(e){return e.o||e.t}function d(e){if(Array.isArray(e))return e.slice();var t=z(e);delete t[N];for(var r=B(t),n=0;n<r.length;n++){var o=r[n],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function f(e,i){h(e)||t(e)||!r(e)||(o(e)>1&&(e.set=e.add=e.clear=e.delete=p),Object.freeze(e),i&&n(e,(function(e,t){return f(t,!0)}),!0))}function p(){e(2)}function h(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(t){var r=H[t];return r||e(19,t),r}function g(){return _}function v(e,t){t&&(y("Patches"),e.u=[],e.s=[],e.v=t)}function m(e){b(e),e.p.forEach(S),e.p=null}function b(e){e===_&&(_=e.l)}function w(e){return _={p:[],l:_,h:e,m:!0,_:0}}function S(e){var t=e[N];0===t.i||1===t.i?t.j():t.g=!0}function O(t,n){n._=n.p.length;var o=n.p[0],i=void 0!==t&&t!==o;return n.h.O||y("ES5").S(n,t,i),i?(o[N].P&&(m(n),e(4)),r(t)&&(t=C(n,t),n.l||x(n,t)),n.u&&y("Patches").M(o[N],t,n.u,n.s)):t=C(n,o,[]),m(n),n.u&&n.v(n.u,n.s),t!==D?t:void 0}function C(e,t,r){if(h(t))return t;var o=t[N];if(!o)return n(t,(function(n,i){return E(e,o,t,n,i,r)}),!0),t;if(o.A!==e)return t;if(!o.P)return x(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var i=4===o.i||5===o.i?o.o=d(o.k):o.o;n(i,(function(t,n){return E(e,o,i,t,n,r)})),x(e,i,!1),r&&e.u&&y("Patches").R(o,r,e.u,e.s)}return o.o}function E(e,n,o,s,c,u){if(t(c)){var l=C(e,c,u&&n&&3!==n.i&&!i(n.D,s)?u.concat(s):void 0);if(a(o,s,l),!t(l))return;e.m=!1}if(r(c)&&!h(c)){if(!e.h.N&&e._<1)return;C(e,c),n&&n.A.l||x(e,c)}}function x(e,t,r){void 0===r&&(r=!1),e.h.N&&e.m&&f(t,r)}function A(e,t){var r=e[N];return(r?l(r):e)[t]}function P(e){e.P||(e.P=!0,e.l&&P(e.l))}function I(e){e.o||(e.o=d(e.t))}function j(e,t,r){var n=c(t)?y("MapSet").T(t,r):u(t)?y("MapSet").F(t,r):e.O?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:g(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=n,i=L;r&&(o=[n],i=$);var a=Proxy.revocable(o,i),s=a.revoke,c=a.proxy;return n.k=c,n.j=s,c}(t,r):y("ES5").J(t,r);return(r?r.A:g()).p.push(n),n}function q(i){return t(i)||e(22,i),function e(t){if(!r(t))return t;var i,s=t[N],c=o(t);if(s){if(!s.P&&(s.i<4||!y("ES5").K(s)))return s.t;s.I=!0,i=R(t,c),s.I=!1}else i=R(t,c);return n(i,(function(t,r){s&&function(e,t){return 2===o(e)?e.get(t):e[t]}(s.t,t)===r||a(i,t,e(r))})),3===c?new Set(i):i}(i)}function R(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return d(e)}var T,_,k="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),F="undefined"!=typeof Map,V="undefined"!=typeof Set,M="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,D=k?Symbol("immer-nothing"):((T={})["immer-nothing"]=!0,T),U=k?Symbol("immer-draftable"):"__$immer_draftable",N=k?Symbol("immer-state"):"__$immer_state",B="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,z=Object.getOwnPropertyDescriptors||function(e){var t={};return B(e).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)})),t},H={},L={get:function(e,t){if(t===N)return e;var n=l(e);if(!i(n,t))return function(e,t,r){if(r in t)for(var n=Object.getPrototypeOf(t);n;){var o,i=Object.getOwnPropertyDescriptor(n,r);if(i)return"value"in i?i.value:null===(o=i.get)||void 0===o?void 0:o.call(e.k);n=Object.getPrototypeOf(n)}}(e,n,t);var o=n[t];return e.I||!r(o)?o:o===A(e.t,t)?(I(e),e.o[t]=j(e.A.h,o,e)):o},has:function(e,t){return t in l(e)},ownKeys:function(e){return Reflect.ownKeys(l(e))},set:function(e,t,r){if(e.D[t]=!0,!e.P){if(s(r,A(l(e),t))&&void 0!==r)return!0;I(e),P(e)}return e.o[t]=r,!0},deleteProperty:function(e,t){return void 0!==A(e.t,t)||t in e.t?(e.D[t]=!1,I(e),P(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=l(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){e(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){e(12)}},$={};n(L,(function(e,t){$[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),$.deleteProperty=function(e,t){return L.deleteProperty.call(this,e[0],t)},$.set=function(e,t,r){return L.set.call(this,e[0],t,r,e[0])};var Q=new(function(){function n(e){this.O=M,this.N=!1,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var o=n.prototype;return o.produce=function(t,n,o){if("function"==typeof t&&"function"!=typeof n){var i=n;n=t;var a=this;return function(e){var t=this;void 0===e&&(e=i);for(var r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return a.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(o))}))}}var s;if("function"!=typeof n&&e(6),void 0!==o&&"function"!=typeof o&&e(7),r(t)){var c=w(this),u=j(this,t,void 0),l=!0;try{s=n(u),l=!1}finally{l?m(c):b(c)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return v(c,o),O(e,c)}),(function(e){throw m(c),e})):(v(c,o),O(s,c))}if(!t||"object"!=typeof t){if((s=n(t))===D)return;return void 0===s&&(s=t),this.N&&f(s,!0),s}e(21,t)},o.produceWithPatches=function(e,t){var r,n,o=this;return"function"==typeof e?function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return o.produceWithPatches(t,(function(t){return e.apply(void 0,[t].concat(n))}))}:[this.produce(e,t,(function(e,t){r=e,n=t})),r,n]},o.createDraft=function(n){r(n)||e(8),t(n)&&(n=q(n));var o=w(this),i=j(this,n,void 0);return i[N].C=!0,b(o),i},o.finishDraft=function(e,t){var r=(e&&e[N]).A;return v(r,t),O(void 0,r)},o.setAutoFreeze=function(e){this.N=e},o.setUseProxies=function(t){t&&!M&&e(20),this.O=t},o.applyPatches=function(e,r){var n;for(n=r.length-1;n>=0;n--){var o=r[n];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}var i=y("Patches").$;return t(e)?i(e,r):this.produce(e,(function(e){return i(e,r.slice(n+1))}))},n}()),Y=Q.produce;Q.produceWithPatches.bind(Q),Q.setAutoFreeze.bind(Q),Q.setUseProxies.bind(Q),Q.applyPatches.bind(Q),Q.createDraft.bind(Q),Q.finishDraft.bind(Q);var W=function(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),J=function(){return Math.random().toString(36).substring(7).split("").join(".")},K={INIT:"@@redux/INIT"+J(),REPLACE:"@@redux/REPLACE"+J(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+J()}};function G(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function X(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(X)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,i=t,a=[],s=a,c=!1;function u(){s===a&&(s=a.slice())}function l(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function d(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return u(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,u();var r=s.indexOf(e);s.splice(r,1),a=null}}}function f(e){if(!G(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,e)}finally{c=!1}for(var t=a=s,r=0;r<t.length;r++){(0,t[r])()}return e}function p(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,f({type:K.REPLACE})}function h(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(l())}return r(),{unsubscribe:t(r)}}})[W]=function(){return this},e}return f({type:K.INIT}),(n={dispatch:f,subscribe:d,getState:l,replaceReducer:p})[W]=h,n}function Z(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function ee(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];"function"==typeof e[o]&&(r[o]=e[o])}var i,a=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:K.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:K.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+K.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,o={},s=0;s<a.length;s++){var c=a[s],u=r[c],l=e[c],d=u(l,t);if(void 0===d){var f=Z(c,t);throw new Error(f)}o[c]=d,n=n||d!==l}return(n=n||a.length!==Object.keys(e).length)?o:e}}function te(e,t){return function(){return t(e.apply(this,arguments))}}function re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ne(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(r,!0).forEach((function(t){re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ie(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function ae(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return oe({},r,{dispatch:n=ie.apply(void 0,i)(r.dispatch)})}}}var se=Object.freeze({__proto__:null,__DO_NOT_USE__ActionTypes:K,applyMiddleware:ae,bindActionCreators:function(e,t){if("function"==typeof e)return te(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');var r={};for(var n in e){var o=e[n];"function"==typeof o&&(r[n]=te(o,t))}return r},combineReducers:ee,compose:ie,createStore:X});function ce(e,t){return e===t}function ue(e,t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var n=t.length,o=0;o<n;o++)if(!e(t[o],r[o]))return!1;return!0}function le(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+r+"]")}return t}var de=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=0,a=n.pop(),s=le(n),c=e.apply(void 0,[function(){return i++,a.apply(null,arguments)}].concat(r)),u=e((function(){for(var e=[],t=s.length,r=0;r<t;r++)e.push(s[r].apply(null,arguments));return c.apply(null,e)}));return u.resultFunc=a,u.dependencies=s,u.recomputations=function(){return i},u.resetRecomputations=function(){return i=0},u}}((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce,r=null,n=null;return function(){return ue(t,r,arguments)||(n=e.apply(null,arguments)),r=arguments,n}}));function fe(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}var pe=fe();function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function me(e,t,r){return(me=ve()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ge(o,r.prototype),o}).apply(null,arguments)}function be(e){var t="function"==typeof Map?new Map:void 0;return(be=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return me(e,arguments,ye(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ge(r,e)})(e)}pe.withExtraArgument=fe;var we="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?ie:ie.apply(null,arguments)};var Se=function(e){var t,r;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var o=n.prototype;return o.concat=function(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return me(n,(t=e.prototype.concat).call.apply(t,[this].concat(o)))},o.prepend=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 1===t.length&&Array.isArray(t[0])?me(n,t[0].concat(this)):me(n,t.concat(this))},n}(be(Array));function Oe(e){void 0===e&&(e={});var t=e,r=t.thunk,n=void 0===r||r,o=(t.immutableCheck,t.serializableCheck,new Se);return n&&(!function(e){return"boolean"==typeof e}(n)?o.push(pe.withExtraArgument(n.extraArgument)):o.push(pe)),o}function Ce(e){var t,r=function(e){return Oe(e)},n=e||{},o=n.reducer,i=void 0===o?void 0:o,a=n.middleware,s=void 0===a?r():a,c=n.devTools,u=void 0===c||c,l=n.preloadedState,d=void 0===l?void 0:l,f=n.enhancers,p=void 0===f?void 0:f;if("function"==typeof i)t=i;else{if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(i))throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');t=ee(i)}var h=ae.apply(void 0,"function"==typeof s?s(r):s),y=ie;u&&(y=we(he({trace:!1},"object"==typeof u&&u)));var g=[h];return Array.isArray(p)?g=[h].concat(p):"function"==typeof p&&(g=p(g)),X(t,d,y.apply(void 0,g))}function Ee(e,t){function r(){if(t){var r=t.apply(void 0,arguments);if(!r)throw new Error("prepareAction did not return an object");return he({type:e,payload:r.payload},"meta"in r&&{meta:r.meta},{},"error"in r&&{error:r.error})}return{type:e,payload:arguments.length<=0?void 0:arguments[0]}}return r.toString=function(){return""+e},r.type=e,r.match=function(t){return t.type===e},r}function xe(e,n,o,i){void 0===o&&(o=[]);var a="function"==typeof n?function(e){var t,r={},n=[],o={addCase:function(e,t){var n="string"==typeof e?e:e.type;if(n in r)throw new Error("addCase cannot be called with two reducers for the same action type");return r[n]=t,o},addMatcher:function(e,t){return n.push({matcher:e,reducer:t}),o},addDefaultCase:function(e){return t=e,o}};return e(o),[r,n,t]}(n):[n,o,i],s=a[0],c=a[1],u=a[2];return function(n,o){void 0===n&&(n=e);var i=[s[o.type]].concat(c.filter((function(e){return(0,e.matcher)(o)})).map((function(e){return e.reducer})));return 0===i.filter((function(e){return!!e})).length&&(i=[u]),i.reduce((function(e,n){if(n){if(t(e)){var i=n(e,o);return void 0===i?e:i}if(r(e))return Y(e,(function(e){return n(e,o)}));var a=n(e,o);if(void 0===a)throw Error("A case reducer on a non-draftable value must not return undefined");return a}return e}),n)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var Ae=["name","message","stack","code"],Pe=function(e){this.value=e},Ie=function(e){if("object"==typeof e&&null!==e){var t={},r=Ae,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var a=i;"string"==typeof e[a]&&(t[a]=e[a])}return t}return{message:String(e)}};function je(e,t,r){var n=Ee(e+"/fulfilled",(function(e,t,r){return{payload:e,meta:{arg:r,requestId:t}}})),o=Ee(e+"/pending",(function(e,t){return{payload:void 0,meta:{arg:t,requestId:e}}})),i=Ee(e+"/rejected",(function(e,t,r,n){var o=!!e&&"AbortError"===e.name,i=!!e&&"ConditionError"===e.name;return{payload:n,error:Ie(e||"Rejected"),meta:{arg:r,requestId:t,aborted:o,condition:i}}})),a="undefined"!=typeof AbortController?AbortController:function(){function e(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){}}}return e.prototype.abort=function(){},e}();return Object.assign((function(e){return function(s,c,u){var l,d=function(e){void 0===e&&(e=21);for(var t="",r=e;r--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t}(),f=new a,p=new Promise((function(e,t){return f.signal.addEventListener("abort",(function(){return t({name:"AbortError",message:l||"Aborted"})}))})),h=!1;var y=function(){try{var a,l=function(e){return y?e:(r&&!r.dispatchConditionRejection&&i.match(a)&&a.meta.condition||s(a),a)},y=!1,g=function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}((function(){if(r&&r.condition&&!1===r.condition(e,{getState:c,extra:u}))throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return h=!0,s(o(d,e)),Promise.resolve(Promise.race([p,Promise.resolve(t(e,{dispatch:s,getState:c,extra:u,requestId:d,signal:f.signal,rejectWithValue:function(e){return new Pe(e)}})).then((function(t){return t instanceof Pe?i(null,d,e,t.value):n(t,d,e)}))])).then((function(e){a=e}))}),(function(t){a=i(t,d,e)}));return Promise.resolve(g&&g.then?g.then(l):l(g))}catch(e){return Promise.reject(e)}}();return Object.assign(y,{abort:function(e){h&&(l=e,f.abort())}})}}),{pending:o,rejected:i,fulfilled:n,typePrefix:e})}!function(){function e(e,t){var r=c[e];return r?r.enumerable=t:c[e]=r={configurable:!0,enumerable:t,get:function(){var t=this[N];return L.get(t,e)},set:function(t){var r=this[N];L.set(r,e,t)}},r}function r(e){for(var t=e.length-1;t>=0;t--){var r=e[t][N];if(!r.P)switch(r.i){case 5:a(r)&&P(r);break;case 4:o(r)&&P(r)}}}function o(e){for(var t=e.t,r=e.k,n=B(r),o=n.length-1;o>=0;o--){var a=n[o];if(a!==N){var c=t[a];if(void 0===c&&!i(t,a))return!0;var u=r[a],l=u&&u[N];if(l?l.t!==c:!s(u,c))return!0}}var d=!!t[N];return n.length!==B(t).length+(d?0:1)}function a(e){var t=e.k;if(t.length!==e.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}var c={};!function(e,t){H[e]=t}("ES5",{J:function(t,r){var n=Array.isArray(t),o=function(t,r){var n=z(r);t&&delete n.length,delete n[N];for(var o=B(n),i=0;i<o.length;i++){var a=o[i];n[a]=e(a,t||!!n[a].enumerable)}if(t){var s=Array(r.length);return Object.defineProperties(s,n),s}return Object.create(Object.getPrototypeOf(r),n)}(n,t),i={i:n?5:4,A:r?r.A:g(),P:!1,I:!1,D:{},l:r,t:t,k:o,o:null,g:!1,C:!1};return Object.defineProperty(o,N,{value:i,writable:!0}),o},S:function(e,o,s){s?t(o)&&o[N].A===e&&r(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var r=t[N];if(r){var o=r.t,s=r.k,c=r.D,u=r.i;if(4===u)n(s,(function(t){t!==N&&(void 0!==o[t]||i(o,t)?c[t]||e(s[t]):(c[t]=!0,P(r)))})),n(o,(function(e){void 0!==s[e]||i(s,e)||(c[e]=!1,P(r))}));else if(5===u){if(a(r)&&(P(r),c.length=!0),s.length<o.length)for(var l=s.length;l<o.length;l++)c[l]=!1;else for(var d=o.length;d<s.length;d++)c[d]=!0;for(var f=Math.min(s.length,o.length),p=0;p<f;p++)void 0===c[p]&&e(s[p])}}}}(e.p[0]),r(e.p))},K:function(e){return 4===e.i?o(e):a(e)}})}();class qe extends Error{constructor(e){super("The following properties are invalid:"+e.map(e=>"\n"+e)),this.name="SchemaValidationError"}}class Re{constructor(e){this.definition=e}validate(e={}){const t={...this.default,...e},r=[];for(const e in this.definition){const n=this.definition[e].validate(t[e]);n&&r.push(`${e}: ${n}`)}if(r.length)throw new qe(r);return t}get default(){const e={};for(const t in this.definition){const r=this.definition[t].default;void 0!==r&&(e[t]=r)}return e}}class Te{constructor(e={}){this.baseConfig=e}validate(e){return this.baseConfig.required&&ke(e)?"value is required.":null}get default(){return this.baseConfig.default instanceof Function?this.baseConfig.default():this.baseConfig.default}required(){return!0===this.baseConfig.required}}function _e(e){return void 0===e}function ke(e){return _e(e)||function(e){return null===e}(e)}class Fe{constructor(e={}){this.config=e,this.value=new Te(e)}validate(e){return this.value.validate(e)||(function(e){return _e(e)||Ve(e)}(e)?e<this.config.min?`minimum value of ${this.config.min} not respected.`:e>this.config.max?`maximum value of ${this.config.max} not respected.`:null:"value is not a number.")}get default(){return this.value.default}get required(){return this.value.required()}}function Ve(e){return"number"==typeof e}class Me{constructor(e={}){this.value=new Te(e)}validate(e){return this.value.validate(e)||(function(e){return _e(e)||De(e)}(e)?null:"value is not a boolean.")}get default(){return this.value.default}get required(){return this.value.required()}}function De(e){return"boolean"==typeof e}const Ue={emptyAllowed:!0,url:!1},Ne=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;class Be{constructor(e={}){this.config={...Ue,...e},this.value=new Te(this.config)}validate(e){return this.value.validate(e)||(_e(e)?null:ze(e)?this.config.emptyAllowed||e.length?this.config.url&&!Ne.test(e)?"value is not a valid URL.":null:"value is an empty string.":"value is not a string.")}get default(){return this.value.default}get required(){return this.value.required()}}function ze(e){return"[object String]"===Object.prototype.toString.call(e)}class He{constructor(e={}){this.config=e,this.value=new Te(this.config)}validate(e){if(!ke(e)&&!Array.isArray(e))return"value is not an array";const t=this.value.validate(e);if(null!==t)return t;if(ke(e))return null;if(void 0!==this.config.max&&e.length>this.config.max)return"value contains more than "+this.config.max;if(void 0!==this.config.min&&e.length<this.config.min)return"value contains less than "+this.config.min;if(void 0!==this.config.each){let t="";return e.forEach(r=>{this.config.each.required&&ke(r)&&(t="value is null or undefined: "+e.join(","));const n=this.validatePrimitiveValue(r,this.config.each);null!==n&&(t+=" "+n)}),""===t?null:t}return null}validatePrimitiveValue(e,t){return De(e)||ze(e)||Ve(e)?t.validate(e):"value is not a primitive value"}get default(){}}const Le=(e,t)=>({payload:new Re(t).validate(e)}),$e=(e,t)=>({payload:new Re({value:t}).validate({value:e}).value}),Qe=Ee("configuration/updateBasicConfiguration",e=>Le(e,{accessToken:new Be({required:!0,emptyAllowed:!1}),organizationId:new Be({required:!0,emptyAllowed:!1})})),Ye=Ee("configuration/updateSearchConfiguration",e=>Le(e,{searchApiBaseUrl:new Be({url:!0,emptyAllowed:!1}),pipeline:new Be({default:"default"}),searchHub:new Be({default:"default"})})),We=je("configuration/renewAccessToken",async e=>await e()),Je=Ee("configuration/analytics/disable"),Ke=Ee("configuration/analytics/enable");var Ge=Object.freeze({__proto__:null,updateBasicConfiguration:Qe,updateSearchConfiguration:Ye,renewAccessToken:We,disableAnalytics:Je,enableAnalytics:Ke}),Xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ze(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var et=Ze((function(e,t){var r=function(e){function t(){this.fetch=!1,this.DOMException=e.DOMException}return t.prototype=e,new t}("undefined"!=typeof self?self:Xe);!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,a="ArrayBuffer"in e;if(a)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&s.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function y(e){var t=new FileReader,r=h(t);return t.readAsArrayBuffer(e),r}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&o&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=h(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=u(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},f.prototype.delete=function(e){delete this.map[u(e)]},f.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},f.prototype.set=function(e,t){this.map[u(e)]=l(t)},f.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),d(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),d(e)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var r,n,o=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),m.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function S(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},v.call(b.prototype),v.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:0,statusText:""});return e.type="error",e};var O=[301,302,303,307,308];S.redirect=function(e,t){if(-1===O.indexOf(t))throw new RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function C(e,r){return new Promise((function(n,i){var a=new b(e,r);if(a.signal&&a.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function c(){s.abort()}s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var o="response"in s?s.response:s.responseText;n(new S(o,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),a.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),a.signal&&(a.signal.addEventListener("abort",c),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",c)}),s.send(void 0===a._bodyInit?null:a._bodyInit)}))}C.polyfill=!0,e.fetch||(e.fetch=C,e.Headers=f,e.Request=b,e.Response=S),t.Headers=f,t.Request=b,t.Response=S,t.fetch=C}({})}(r),delete r.fetch.polyfill,(t=r.fetch).default=r.fetch,t.fetch=r.fetch,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,e.exports=t}));et.fetch,et.Headers,et.Request,et.Response;class tt{static async call(e){const t=await et(e.url,{method:e.method,headers:{"Content-Type":e.contentType,Authorization:"Bearer "+e.accessToken},body:JSON.stringify(e.requestParams)}),r=await t.json();return{response:t,body:r}}}const rt=e=>({organizationId:e.configuration.organizationId}),nt=e=>({q:e.query.q}),ot=e=>e.configuration.accessToken,it=e=>e.configuration.search.searchApiBaseUrl,at=(e,t,r,n)=>({accessToken:ot(e),method:t,contentType:r,url:`${it(e)}${n}`}),st=e=>({...nt(e),numberOfResults:e.pagination.numberOfResults,sortCriteria:e.sortCriteria,firstResult:e.pagination.firstResult,facets:ct(e),context:e.context.contextValues,enableDidYouMean:e.didYouMean.enableDidYouMean,fieldsToInclude:e.fields.fieldsToInclude,pipeline:e.pipeline,searchHub:e.searchHub});function ct(e){return[...ut(e.facetSet),...ut(e.numericFacetSet),...ut(e.dateFacetSet)]}function ut(e){return Object.keys(e).map(t=>e[t])}const lt=(e,t)=>{const{captions:r,numberOfValues:n,query:o}=t.facetSearchSet[e].options,{field:i,delimitingCharacter:a,currentValues:s}=t.facetSet[e],c=st(t);return{captions:r,numberOfValues:n,query:o,field:i,delimitingCharacter:a,ignoreValues:s.filter(e=>"idle"!==e.state).map(e=>e.value),searchContext:c,type:"specific"}},dt=e=>({...nt(e),...rt(e),context:e.context.contextValues,pipeline:e.pipeline,searchHub:e.searchHub}),ft=(e,t)=>({...rt(t),count:t.querySuggest[e].count,q:t.querySuggest[e].q,context:t.context.contextValues,pipeline:t.pipeline,searchHub:t.searchHub});class pt{static async plan(e){const t=await tt.call({...at(e,"POST","application/json","/plan"),requestParams:dt(e)});return function(e){return void 0!==e.body.preprocessingOutput}(t)?{success:t.body}:{error:ht(t)}}static async querySuggest(e,t){const r=await tt.call({...at(t,"POST","application/json","/querySuggest"),requestParams:ft(e,t)});return function(e){return void 0!==e.body.completions}(r)?{success:r.body}:{error:ht(r)}}static async search(e){const t=await tt.call({...at(e,"POST","application/json",""),requestParams:st(e)});return function(e){return void 0!==e.body.results}(t)?{success:t.body}:{error:ht(t)}}static async facetSearch(e,t){return(await tt.call({...at(t,"POST","application/json","/facet"),requestParams:lt(e,t)})).body}}const ht=e=>function(e){return void 0!==e.body.exception}(e)?yt(e):function(e){return void 0!==e.body.statusCode}(e)?gt(e):{message:"unknown",statusCode:0,type:"unknown"},yt=e=>({message:e.body.exception.code,statusCode:e.response.status,type:e.body.exception.code}),gt=e=>({message:e.body.message,statusCode:e.body.statusCode,type:e.body.type}),vt=e=>void 0!==e.error;const mt="@@undoable/UNDO",bt="@@undoable/REDO",wt=e=>({past:[],present:e,future:[]}),St=()=>Ee(mt),Ot=()=>Ee(bt);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function Ct(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function Et(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}var xt;!function(e){e.search="search",e.click="click",e.custom="custom",e.view="view",e.collect="collect"}(xt||(xt={}));class At{constructor(e){this.opts=e}sendEvent(e,t){return Et(this,void 0,void 0,(function*(){const{baseUrl:r,visitorIdProvider:n}=this.opts,o=this.shouldAppendVisitorId(e)?this.visitorIdParam:"",i=yield fetch(`${r}/analytics/${e}${o}`,{method:"POST",headers:this.getHeaders(),mode:"cors",body:JSON.stringify(t),credentials:"include"});if(i.ok){const e=yield i.json();return e.visitorId&&(n.currentVisitorId=e.visitorId),e}try{i.json()}catch(e){}throw console.error(`An error has occured when sending the "${e}" event.`,i,t),new Error(`An error has occurred when sending the "${e}" event. Check the console logs for more details.`)}))}shouldAppendVisitorId(e){return-1!==[xt.click,xt.custom,xt.search,xt.view].indexOf(e)}get visitorIdParam(){const{visitorIdProvider:e}=this.opts,t=e.currentVisitorId;return t?"?visitor="+t:""}getHeaders(){const{token:e}=this.opts;return Object.assign(Object.assign({},e?{Authorization:"Bearer "+e}:{}),{"Content-Type":"application/json"})}}function Pt(){return"undefined"!=typeof localStorage}function It(){return"undefined"!=typeof navigator&&navigator.cookieEnabled}const jt=[xt.click,xt.custom,xt.search,xt.view],qt=(e,t)=>-1!==jt.indexOf(e)?Object.assign({language:document.documentElement.lang,userAgent:navigator.userAgent},t):t;class Rt{static set(e,t,r){var n,o,i,a,s;r?((i=new Date).setTime(i.getTime()+r),a="; expires="+i.toGMTString()):a="",-1===(s=location.hostname).indexOf(".")?document.cookie=e+"="+t+a+"; path=/":((o=s.split(".")).shift(),n="."+o.join("."),document.cookie=e+"="+t+a+"; path=/; domain="+n,null!=Rt.get(e)&&Rt.get(e)==t||(n="."+s,document.cookie=e+"="+t+a+"; path=/; domain="+n))}static get(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){var o=r[n];if(0==(o=o.replace(/^\s+/,"")).indexOf(t))return o.substring(t.length,o.length)}return null}static erase(e){Rt.set(e,"",-1)}}class Tt{getItem(e){return Rt.get(`${Tt.prefix}${e}`)}removeItem(e){Rt.erase(`${Tt.prefix}${e}`)}setItem(e,t){Rt.set(`${Tt.prefix}${e}`,t)}}Tt.prefix="coveo_";class _t{constructor(){this.cookieStorage=new Tt}getItem(e){return localStorage.getItem(e)||this.cookieStorage.getItem(e)}removeItem(e){this.cookieStorage.removeItem(e),localStorage.removeItem(e)}setItem(e,t){localStorage.setItem(e,t),this.cookieStorage.setItem(e,t)}}class kt{getItem(e){return null}removeItem(e){}setItem(e,t){}}const Ft="__coveo.analytics.history";class Vt{constructor(e){this.store=e||(Pt()?localStorage:It()?new Tt:"undefined"!=typeof sessionStorage?sessionStorage:new kt),this.store instanceof Tt||!It()||(new Tt).removeItem(Ft)}addElement(e){e.internalTime=(new Date).getTime(),this.cropQueryElement(e);let t=this.getHistoryWithInternalTime();null!=t?this.isValidEntry(e)&&this.setHistory([e].concat(t)):this.setHistory([e])}getHistory(){const e=this.getHistoryWithInternalTime();return this.stripInternalTime(e)}getHistoryWithInternalTime(){try{const e=this.store.getItem(Ft);return e?JSON.parse(e):[]}catch(e){return[]}}setHistory(e){try{this.store.setItem(Ft,JSON.stringify(e.slice(0,20)))}catch(e){}}clear(){try{this.store.removeItem(Ft)}catch(e){}}getMostRecentElement(){let e=this.getHistoryWithInternalTime();return null!=e?e.sort((e,t)=>(t.internalTime||0)-(e.internalTime||0))[0]:null}cropQueryElement(e){e.name&&"query"==e.name.toLowerCase()&&null!=e.value&&(e.value=e.value.slice(0,75))}isValidEntry(e){let t=this.getMostRecentElement();return!t||t.value!=e.value||(e.internalTime||0)-(t.internalTime||0)>6e4}stripInternalTime(e){return e.map(e=>{const{name:t,time:r,value:n}=e;return{name:t,time:r,value:n}})}}const Mt=(e,t)=>e===xt.view?(Dt(t.contentIdValue),Object.assign({location:window.location.toString(),referrer:document.referrer,title:document.title},t)):t,Dt=e=>{const t=new Vt,r={name:"PageView",value:e,time:JSON.stringify(new Date)};t.addElement(r)},Ut=e=>e?(Number(e)^Nt(new Uint8Array(1))[0]%16>>Number(e)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,Ut),Nt=e=>{if("undefined"!=typeof crypto&&void 0!==crypto.getRandomValues)return crypto.getRandomValues(e);for(var t=0,r=0;t<e.length;t++)0==(3&t)&&(r=4294967296*Math.random()),e[t]=r>>>((3&t)<<3)&255;return e},Bt={id:"id",name:"nm",brand:"br",category:"ca",variant:"va",price:"pr",quantity:"qt",coupon:"cc",position:"ps"},zt={id:"id",name:"nm",brand:"br",category:"ca",variant:"va",position:"ps",price:"pr"},Ht=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},{eventCategory:"ec",eventAction:"ea",eventLabel:"el",eventValue:"ev",page:"dp",visitorId:"cid",clientId:"cid",userId:"uid",currencyCode:"cu"}),{action:"pa",list:"pal",listSource:"pls"}),{id:"ti",revenue:"tr",tax:"tt",shipping:"ts",coupon:"tcc",affiliation:"ta",step:"cos",option:"col"}),{hitType:"t",pageViewId:"pid",encoding:"de",location:"dl",referrer:"dr",screenColor:"sd",screenResolution:"sr",title:"dt",userAgent:"ua",language:"ul",eventId:"z",time:"tm"}),{anonymizeIp:"aip"}),Lt=Object.keys,$t=Lt(Ht).map(e=>Ht[e]),Qt=Lt(Bt).map(e=>Bt[e]),Yt=Lt(zt).map(e=>zt[e]),Wt=[...Qt,"custom"].join("|"),Jt=[...Yt,"custom"].join("|"),Kt=new RegExp(`^(pr[0-9]+)(${Wt})$`),Gt=new RegExp(`^((il[0-9]+pi[0-9]+)(${Jt}))|(il[0-9]+nm)$`),Xt=new RegExp("^(pr[0-9]+)custom$"),Zt=new RegExp("^(il[0-9]+pi[0-9]+)custom$"),er=e=>Kt.test(e),tr=e=>Gt.test(e),rr=e=>-1!==$t.indexOf(e),nr=e=>"custom"===e;class or{constructor(e){this.opts=e}sendEvent(e,t){return Et(this,void 0,void 0,(function*(){if(!navigator.sendBeacon)throw new Error('navigator.sendBeacon is not supported in this browser. Consider adding a polyfill like "sendbeacon-polyfill".');const{baseUrl:r}=this.opts,n=this.encodeForEventType(e,t),o=this.getQueryParamsForEventType(e),i=`${r}/analytics/${e}?${o}`;console.log(`Sending beacon for "${e}" with: `,JSON.stringify(t)),navigator.sendBeacon(i,new Blob([n],{type:"application/x-www-form-urlencoded"}))}))}encodeForEventType(e,t){return this.isEventTypeLegacy(e)?this.encodeForLegacyType(e,t):this.encodeForFormUrlEncoded(Object.assign({access_token:this.opts.token},t))}getQueryParamsForEventType(e){const{token:t,visitorIdProvider:r}=this.opts,n=r.currentVisitorId;return[t&&this.isEventTypeLegacy(e)?"access_token="+t:"",n?"visitorId="+n:""].filter(e=>!!e).join("&")}isEventTypeLegacy(e){return-1!==[xt.click,xt.custom,xt.search,xt.view].indexOf(e)}encodeForLegacyType(e,t){return`${e}Event=${encodeURIComponent(JSON.stringify(t))}`}encodeForFormUrlEncoded(e){return Object.keys(e).filter(t=>!!e[t]).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(this.encodeValue(e[t]))}`).join("&")}encodeValue(e){return"number"==typeof e||"string"==typeof e||"boolean"==typeof e?e:JSON.stringify(e)}}class ir{sendEvent(e,t){return Et(this,void 0,void 0,(function*(){return Promise.resolve()}))}}class ar{constructor(e,t){Pt()&&It()?this.storage=new _t:Pt()?this.storage=localStorage:(console.warn("BrowserRuntime detected no valid storage available.",this),this.storage=new kt),this.beaconClient=new or(e),window.addEventListener("beforeunload",()=>t())}}class sr{constructor(){this.storage=new kt,this.beaconClient=new ir}}class cr{constructor(){this.storage=new kt,this.beaconClient=new ir}}class ur{constructor(e){if(!e)throw new Error("You have to pass options to this constructor");this.options=Object.assign(Object.assign({},this.defaultOptions),e),this.visitorId="",this.bufferedRequests=[],this.beforeSendHooks=[Mt,qt],this.eventTypeMapping={};const t={baseUrl:this.baseUrl,token:this.options.token,visitorIdProvider:this};this.runtime=this.initRuntime(t),this.analyticsFetchClient=new At(t),this.initVisitorId()}get defaultOptions(){return{endpoint:"https://platform.cloud.coveo.com/rest/ua",token:"",version:"v15"}}initRuntime(e){return"undefined"!=typeof window&&"undefined"!=typeof document?new ar(e,()=>this.flushBufferWithBeacon()):new sr}get analyticsBeaconClient(){return this.runtime.beaconClient}get storage(){return this.runtime.storage}initVisitorId(){const e=this.visitorId||this.storage.getItem("visitorId")||"";this.currentVisitorId=e||Ut()}get currentVisitorId(){return this.visitorId}set currentVisitorId(e){this.visitorId=e,this.storage.setItem("visitorId",e)}sendEvent(e,...t){return Et(this,void 0,void 0,(function*(){const{newEventType:r=e,variableLengthArgumentsNames:n=[],addVisitorIdParameter:o=!1,usesMeasurementProtocol:i=!1}=this.eventTypeMapping[e]||{},a=[e=>n.length>0?this.parseVariableArgumentsPayload(n,e):e[0],e=>Object.assign({visitorId:o?this.visitorId:""},e),e=>i?this.ensureAnonymousUserWhenUsingApiKey(e):e,t=>this.beforeSendHooks.reduce((t,r)=>r(e,t),t),t=>this.removeEmptyPayloadValues(t,e),e=>this.validateParams(e),e=>{return i?Lt(t=e).reduce((e,r)=>{const n=Ht[r]||r;return Object.assign(Object.assign({},e),{[n]:t[r]})},{}):e;var t},e=>i?this.removeUnknownParameters(e):e,e=>i?this.processCustomParameters(e):e].reduce((e,t)=>t(e),t);return this.bufferedRequests.push({eventType:r,payload:a,handled:!1}),yield this.deferExecution(),yield this.sendFromBufferWithFetch()}))}deferExecution(){return new Promise(e=>setTimeout(e,0))}flushBufferWithBeacon(){for(;this.hasPendingRequests();){const{eventType:e,payload:t}=this.bufferedRequests.pop();this.analyticsBeaconClient.sendEvent(e,t)}}sendFromBufferWithFetch(){return Et(this,void 0,void 0,(function*(){const e=this.bufferedRequests.shift();if(e){const{eventType:t,payload:r}=e;return this.analyticsFetchClient.sendEvent(t,r)}}))}hasPendingRequests(){return this.bufferedRequests.length>0}clear(){this.storage.removeItem("visitorId"),(new Vt).clear()}sendSearchEvent(e){return Et(this,void 0,void 0,(function*(){return this.sendEvent(xt.search,e)}))}sendClickEvent(e){return Et(this,void 0,void 0,(function*(){return this.sendEvent(xt.click,e)}))}sendCustomEvent(e){return Et(this,void 0,void 0,(function*(){return this.sendEvent(xt.custom,e)}))}sendViewEvent(e){return Et(this,void 0,void 0,(function*(){return this.sendEvent(xt.view,e)}))}getVisit(){return Et(this,void 0,void 0,(function*(){const e=yield fetch(this.baseUrl+"/analytics/visit"),t=yield e.json();return this.visitorId=t.visitorId,t}))}getHealth(){return Et(this,void 0,void 0,(function*(){const e=yield fetch(this.baseUrl+"/analytics/monitoring/health");return yield e.json()}))}registerBeforeSendEventHook(e){this.beforeSendHooks.push(e)}addEventTypeMapping(e,t){this.eventTypeMapping[e]=t}parseVariableArgumentsPayload(e,t){const r={};for(let n=0,o=t.length;n<o;n++){const o=t[n];if("string"==typeof o)r[e[n]]=o;else if("object"==typeof o)return Object.assign(Object.assign({},r),o)}return r}isKeyAllowedEmpty(e,t){return-1!==({[xt.search]:["queryText"]}[e]||[]).indexOf(t)}removeEmptyPayloadValues(e,t){return Object.keys(e).filter(r=>{return this.isKeyAllowedEmpty(t,r)||null!=(n=e[r])&&""!==n;var n}).reduce((t,r)=>Object.assign(Object.assign({},t),{[r]:e[r]}),{})}removeUnknownParameters(e){return Object.keys(e).filter(e=>{if((e=>[er,tr,rr,nr].some(t=>t(e)))(e))return!0;console.log(e,"is not processed by coveoua")}).reduce((t,r)=>Object.assign(Object.assign({},t),{[r]:e[r]}),{})}processCustomParameters(e){const{custom:t}=e,r=Ct(e,["custom"]),n=Lt(o=r).reduce((e,t)=>{const r=Xt.exec(t)||Zt.exec(t);if(r){const n=r[1];return Object.assign(Object.assign({},e),((e,t)=>Lt(t).reduce((r,n)=>Object.assign(Object.assign({},r),{[`${e}${n}`]:t[n]}),{}))(n,o[t]))}return Object.assign(Object.assign({},e),{[t]:o[t]})},{});var o;return Object.assign(Object.assign({},t||{}),n)}validateParams(e){const{anonymizeIp:t}=e,r=Ct(e,["anonymizeIp"]);return void 0!==t&&-1==["0","false","undefined","null","{}","[]",""].indexOf((""+t).toLowerCase())&&(r.anonymizeIp=1),r}ensureAnonymousUserWhenUsingApiKey(e){const{userId:t}=e,r=Ct(e,["userId"]);return(null==(n=this.options.token)?void 0:n.startsWith("xx"))&&!t?(r.userId="anonymous",r):e;var n}get baseUrl(){const{version:e,endpoint:t}=this.options,r=-1!==t.indexOf(".cloud.coveo.com");return`${t}${r?"":"/rest"}/${e}`}}var lr;!function(e){e.interfaceLoad="interfaceLoad",e.interfaceChange="interfaceChange",e.didyoumeanAutomatic="didyoumeanAutomatic",e.didyoumeanClick="didyoumeanClick",e.resultsSort="resultsSort",e.searchboxSubmit="searchboxSubmit",e.searchboxClear="searchboxClear",e.searchboxAsYouType="searchboxAsYouType",e.breadcrumbFacet="breadcrumbFacet",e.breadcrumbResetAll="breadcrumbResetAll",e.documentQuickview="documentQuickview",e.documentOpen="documentOpen",e.omniboxAnalytics="omniboxAnalytics",e.omniboxFromLink="omniboxFromLink",e.triggerNotify="notify",e.triggerExecute="execute",e.triggerQuery="query",e.triggerRedirect="redirect",e.pagerResize="pagerResize",e.pagerNumber="pagerNumber",e.pagerNext="pagerNext",e.pagerPrevious="pagerPrevious",e.pagerScrolling="pagerScrolling",e.facetClearAll="facetClearAll",e.facetSearch="facetSearch",e.facetSelect="facetSelect",e.facetSelectAll="facetSelectAll",e.facetDeselect="facetDeselect",e.facetExclude="facetExclude",e.facetUnexclude="facetUnexclude",e.facetUpdateSort="facetUpdateSort",e.facetShowMore="showMoreFacetResults",e.facetShowLess="showLessFacetResults",e.queryError="query",e.queryErrorBack="errorBack",e.queryErrorClear="errorClearQuery",e.queryErrorRetry="errorRetry"}(lr||(lr={}));const dr={[lr.triggerNotify]:"queryPipelineTriggers",[lr.triggerExecute]:"queryPipelineTriggers",[lr.triggerQuery]:"queryPipelineTriggers",[lr.triggerRedirect]:"queryPipelineTriggers",[lr.queryError]:"errors",[lr.queryErrorBack]:"errors",[lr.queryErrorClear]:"errors",[lr.queryErrorRetry]:"errors",[lr.pagerNext]:"getMoreResults",[lr.pagerPrevious]:"getMoreResults",[lr.pagerNumber]:"getMoreResults",[lr.pagerResize]:"getMoreResults",[lr.pagerScrolling]:"getMoreResults",[lr.facetSearch]:"facet",[lr.facetShowLess]:"facet",[lr.facetShowMore]:"facet"};class fr{constructor(){this.runtime=new cr}sendEvent(){return Promise.resolve()}sendSearchEvent(){return Promise.resolve()}sendClickEvent(){return Promise.resolve()}sendCustomEvent(){return Promise.resolve()}sendViewEvent(){return Promise.resolve()}getVisit(){return Promise.resolve({id:"",visitorId:""})}getHealth(){return Promise.resolve({status:""})}registerBeforeSendEventHook(){}addEventTypeMapping(){}}class pr{constructor(e,t){this.opts=e,this.provider=t,this.coveoAnalyticsClient=!1===e.enableAnalytics?new fr:new ur(e)}disable(){this.coveoAnalyticsClient instanceof ur&&this.coveoAnalyticsClient.clear(),this.coveoAnalyticsClient=new fr}enable(){this.coveoAnalyticsClient=new ur(this.opts)}logInterfaceLoad(){return this.logSearchEvent(lr.interfaceLoad)}logInterfaceChange(e){return this.logSearchEvent(lr.interfaceChange,e)}logDidYouMeanAutomatic(){return this.logSearchEvent(lr.didyoumeanAutomatic)}logDidYouMeanClick(){return this.logSearchEvent(lr.didyoumeanClick)}logResultsSort(e){return this.logSearchEvent(lr.resultsSort,e)}logSearchboxSubmit(){return this.logSearchEvent(lr.searchboxSubmit)}logSearchboxClear(){return this.logSearchEvent(lr.searchboxClear)}logSearchboxAsYouType(){return this.logSearchEvent(lr.searchboxAsYouType)}logBreadcrumbFacet(e){return this.logSearchEvent(lr.breadcrumbFacet,e)}logBreadcrumbResetAll(){return this.logSearchEvent(lr.breadcrumbResetAll)}logDocumentQuickview(e,t){return this.logClickEvent(lr.documentQuickview,e,t)}logDocumentOpen(e,t){return this.logClickEvent(lr.documentOpen,e,t)}logOmniboxAnalytics(e){return this.logSearchEvent(lr.omniboxAnalytics,e)}logOmniboxFromLink(e){return this.logSearchEvent(lr.omniboxFromLink,e)}logTriggerNotify(e){return this.logCustomEvent(lr.triggerNotify,e)}logTriggerExecute(e){return this.logCustomEvent(lr.triggerExecute,e)}logTriggerQuery(){const e={query:this.provider.getSearchEventRequestPayload().queryText};return this.logCustomEvent(lr.triggerQuery,e)}logTriggerRedirect(e){const t=Object.assign(Object.assign({},e),{query:this.provider.getSearchEventRequestPayload().queryText});return this.logCustomEvent(lr.triggerRedirect,t)}logPagerResize(e){return this.logCustomEvent(lr.pagerResize,e)}logPagerNumber(e){return this.logCustomEvent(lr.pagerNumber,e)}logPagerNext(e){return this.logCustomEvent(lr.pagerNext,e)}logPagerPrevious(e){return this.logCustomEvent(lr.pagerPrevious,e)}logPagerScrolling(){return this.logCustomEvent(lr.pagerScrolling)}logFacetClearAll(e){return this.logSearchEvent(lr.facetClearAll,e)}logFacetSearch(e){return this.logSearchEvent(lr.facetSearch,e)}logFacetSelect(e){return this.logSearchEvent(lr.facetSelect,e)}logFacetDeselect(e){return this.logSearchEvent(lr.facetDeselect,e)}logFacetExclude(e){return this.logSearchEvent(lr.facetExclude,e)}logFacetUnexclude(e){return this.logSearchEvent(lr.facetUnexclude,e)}logFacetSelectAll(e){return this.logSearchEvent(lr.facetSelectAll,e)}logFacetUpdateSort(e){return this.logSearchEvent(lr.facetUpdateSort,e)}logFacetShowMore(e){return this.logCustomEvent(lr.facetShowMore,e)}logFacetShowLess(e){return this.logCustomEvent(lr.facetShowLess,e)}logQueryError(e){return this.logCustomEvent(lr.queryError,e)}logQueryErrorBack(){return Et(this,void 0,void 0,(function*(){return yield this.logCustomEvent(lr.queryErrorBack),this.logSearchEvent(lr.queryErrorBack)}))}logQueryErrorRetry(){return Et(this,void 0,void 0,(function*(){return yield this.logCustomEvent(lr.queryErrorRetry),this.logSearchEvent(lr.queryErrorRetry)}))}logQueryErrorClear(){return Et(this,void 0,void 0,(function*(){return yield this.logCustomEvent(lr.queryErrorClear),this.logSearchEvent(lr.queryErrorClear)}))}logCustomEvent(e,t){const r=Object.assign(Object.assign({},this.provider.getBaseMetadata()),t),n={eventType:dr[e],eventValue:e,lastSearchQueryUid:this.provider.getSearchUID(),customData:r};return this.coveoAnalyticsClient.sendCustomEvent(n)}logSearchEvent(e,t){const r=Object.assign(Object.assign({},this.provider.getBaseMetadata()),t),n=Object.assign(Object.assign({},this.provider.getSearchEventRequestPayload()),{searchQueryUid:this.provider.getSearchUID(),queryPipeline:this.provider.getPipeline(),customData:r,actionCause:e});return this.coveoAnalyticsClient.sendSearchEvent(n)}logClickEvent(e,t,r,n){const o=Object.assign(Object.assign(Object.assign({},this.provider.getBaseMetadata()),r),n),i=Object.assign(Object.assign({},t),{searchQueryUid:this.provider.getSearchUID(),queryPipeline:this.provider.getPipeline(),actionCause:e,customData:o});return this.coveoAnalyticsClient.sendClickEvent(i)}}class hr{constructor(e){this.state=e}getSearchEventRequestPayload(){return{queryText:this.queryText,responseTime:this.responseTime,results:this.mapResultsToAnalyticsDocument(),numberOfResults:this.numberOfResults}}getBaseMetadata(){return{}}getSearchUID(){return this.state.search.response.searchUid}getPipeline(){return this.state.pipeline}mapResultsToAnalyticsDocument(){return this.state.search.response.results.map(e=>({documentUri:e.uri,documentUriHash:e.raw.urihash}))}get queryText(){return this.state.query.q}get responseTime(){return this.state.search.duration}get numberOfResults(){return this.state.search.response.results.length}}const yr=e=>{const t=new hr(e),r=new pr({token:e.configuration.accessToken},t);return!1===e.configuration.analyticsEnabled&&r.disable(),r},gr=e=>e();var vr;!function(e){e[e.Search=0]="Search",e[e.Custom=1]="Custom",e[e.Click=2]="Click"}(vr||(vr={}));const mr=()=>({analyticsType:vr.Search}),br=()=>({analyticsType:vr.Click}),wr=je("analytics/generic/search",async(e,{getState:t})=>{const{evt:r,meta:n}=e,o=gr(t);return await yr(o).logSearchEvent(r,n),mr()}),Sr=je("analytics/interface/load",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logInterfaceLoad(),mr()}),Or=(e,t)=>{const r=t.search.response.results.findIndex(({uniqueId:t})=>e.uniqueId===t);return{collectionName:e.raw.collection||"default",documentAuthor:e.raw.author,documentPosition:r+1,documentTitle:e.title,documentUri:e.uri,documentUriHash:e.raw.urihash,documentUrl:e.clickUri,rankingModifier:e.rankingModifier||"",sourceName:e.raw.source,queryPipeline:t.pipeline}},Cr=e=>({contentIDKey:"@permanentid",contentIDValue:e.raw.permanentid});var Er=Object.freeze({__proto__:null,searchPageState:gr,get AnalyticsType(){return vr},makeSearchActionType:mr,makeClickActionType:br,logGenericSearchEvent:wr,logInterfaceLoad:Sr,partialDocumentInformation:Or,documentIdentifier:Cr});const xr=Ee("history/snapshot"),Ar=je("history/back",async(e,{dispatch:t})=>{await t(St()),await t(Ir())}),Pr=je("history/forward",async(e,{dispatch:t})=>{await t(Ot()),await t(Ir())}),Ir=je("history/change",async(e,{getState:t})=>t().history.present),jr=je("history/analytics/forward",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logSearchEvent("historyForward"),mr()}),qr=je("history/analytics/backward",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logSearchEvent("historyBackward"),mr()});var Rr=Object.freeze({__proto__:null,snapshot:xr,back:Ar,forward:Pr,change:Ir,logNavigateForward:jr,logNavigateBackward:qr});const Tr=je("analytics/didyoumean",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logDidYouMeanClick(),mr()}),_r=je("analytics/didyoumean",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logDidYouMeanAutomatic(),mr()}),kr=Ee("didYouMean/enable"),Fr=Ee("didYouMean/disable"),Vr=Ee("didYouMean/correction"),Mr=Ee("query/updateQuery",e=>Le(e,{q:new Be({required:!0})}));var Dr=Object.freeze({__proto__:null,updateQuery:Mr});const Ur=async e=>{const t=(new Date).getTime();return{response:await pt.search(e),duration:(new Date).getTime()-t,queryExecuted:e.query.q}},Nr=je("search/executeSearch",async(e,{getState:t,dispatch:r,rejectWithValue:n})=>{const o=t(),i=await Ur(o);if(vt(i.response))return n(i.response.error);if(!zr(o,i.response.success))return r(xr(Hr(o))),{...i,response:i.response.success,automaticallyCorrected:!1,analyticsAction:e};const a=await Br(i.response.success.queryCorrections[0].correctedQuery,t,r);return r(xr(Hr(t()))),vt(a.response)?n(a.response.error):{...a,response:a.response.success,automaticallyCorrected:!0,analyticsAction:e}}),Br=async(e,t,r)=>{r(Mr({q:e}));const n=await Ur(t());return r(_r()),r(Vr(e)),n},zr=(e,t)=>!0===e.didYouMean.enableDidYouMean&&0===t.results.length&&0!==t.queryCorrections.length,Hr=e=>({context:e.context,facetSet:e.facetSet,numericFacetSet:e.numericFacetSet,dateFacetSet:e.dateFacetSet,pagination:e.pagination,query:e.query,querySet:e.querySet,sortCriteria:e.sortCriteria,pipeline:e.pipeline,searchHub:e.searchHub});var Lr=Object.freeze({__proto__:null,executeSearch:Nr});const $r=e=>t=>r=>{var n,o;const i=null===(n=r.payload)||void 0===n?void 0:n.analyticsAction;void 0!==i&&(null===(o=r.payload)||void 0===o||delete o.analyticsAction);const a=t(r);return r.type===Nr.fulfilled.type&&void 0===i&&console.error("No analytics action associated with search:",r),void 0!==i&&e.dispatch(i),a};class Qr{constructor(e){this.reduxStore=function({reducers:e,preloadedState:t,middlewares:r=[]}){return Ce({reducer:ee(e),preloadedState:t,devTools:{stateSanitizer:e=>e.history?{...e,history:"<<OMIT>>"}:e},middleware:e=>[$r,...r,...e()]})}({preloadedState:e.preloadedState,reducers:e.reducers,middlewares:e.middlewares}),this.reduxStore.dispatch(Qe(e.configuration)),e.configuration.search&&this.reduxStore.dispatch(Ye(e.configuration.search))}static getSampleConfiguration(){return{organizationId:"searchuisamples",accessToken:"xx564559b1-0045-48e1-953c-3addd1ee4457",search:{searchApiBaseUrl:"https://platform.cloud.coveo.com/rest/search",pipeline:"default",searchHub:"default"}}}enableAnalytics(){this.dispatch(Ke())}disableAnalytics(){this.dispatch(Je())}get dispatch(){return this.reduxStore.dispatch}get subscribe(){return this.reduxStore.subscribe}get state(){return this.reduxStore.getState()}}const Yr={id:new Be({required:!0,emptyAllowed:!1})},Wr=Ee("querySuggest/register",e=>Le(e,{...Yr,q:new Be,count:new Fe({min:0})})),Jr=Ee("querySuggest/unregister",e=>Le(e,Yr)),Kr=Ee("querySuggest/selectSuggestion",e=>Le(e,{...Yr,expression:new Be({required:!0})})),Gr=Ee("querySuggest/clear",e=>Le(e,Yr)),Xr=Ee("querySuggest/clearSuggestions",e=>Le(e,Yr)),Zr=je("querySuggest/fetch",async(e,{getState:t,rejectWithValue:r})=>{Le(e,Yr);const n=e.id,o=await async function(e,t){return await pt.querySuggest(e,t)}(n,t());return vt(o)?r({id:n,...o.error}):{id:n,...o.success}});var en=Object.freeze({__proto__:null,registerQuerySuggest:Wr,unregisterQuerySuggest:Jr,selectQuerySuggestion:Kr,clearQuerySuggest:Gr,clearQuerySuggestCompletions:Xr,fetchQuerySuggestions:Zr});const tn=xe({q:""},e=>e.addCase(Mr,(e,t)=>{e.q=t.payload.q}).addCase(Vr,(e,t)=>{e.q=t.payload}).addCase(Kr,(e,t)=>{e.q=t.payload.expression}).addCase(Ir.fulfilled,(e,t)=>{e.q=t.payload.query.q})),rn=xe({organizationId:"",accessToken:"",search:{searchApiBaseUrl:"https://globalplatform.cloud.coveo.com/rest/search"},analyticsEnabled:!0},e=>e.addCase(Qe,(e,t)=>{e.accessToken=t.payload.accessToken,e.organizationId=t.payload.organizationId}).addCase(Ye,(e,t)=>{t.payload.searchApiBaseUrl&&(e.search.searchApiBaseUrl=t.payload.searchApiBaseUrl)}).addCase(We.fulfilled,(e,t)=>{e.accessToken=t.payload}).addCase(Je,e=>{e.analyticsEnabled=!1}).addCase(Ke,e=>{e.analyticsEnabled=!0}));function nn(e){return"redirect"===e.type}class on{constructor(e){this.response=e}get basicExpression(){return this.response.parsedInput.basicExpression}get largeExpression(){return this.response.parsedInput.largeExpression}get redirectionURL(){const e=this.response.preprocessingOutput.triggers.filter(nn);return e.length?e[0].content:null}}const an=je("redirection/check",async(e,{getState:t,rejectWithValue:r})=>{try{return(await async function(e){const t=await pt.plan(e);if(vt(t))throw t.error;return new on(t.success)}(t())).redirectionURL}catch(e){return r(e)}});var sn=Object.freeze({__proto__:null,checkForRedirection:an});const cn=xe({redirectTo:null},e=>e.addCase(an.fulfilled,(e,t)=>{e.redirectTo=t.payload})),un={id:new Be({required:!0,emptyAllowed:!1}),query:new Be({required:!0})},ln=Ee("querySet/register",e=>Le(e,un)),dn=Ee("querySet/update",e=>Le(e,un));var fn=Object.freeze({__proto__:null,registerQuerySetQuery:ln,updateQuerySetQuery:dn});const pn=xe({},e=>e.addCase(Wr,(e,t)=>{e[t.payload.id]={id:"",completions:[],count:5,q:"",currentRequestId:"",error:null,...t.payload}}).addCase(Jr,(e,t)=>{delete e[t.payload.id]}).addCase(Zr.pending,(e,t)=>{e[t.meta.arg.id].currentRequestId=t.meta.requestId}).addCase(Zr.fulfilled,(e,t)=>{var r;const n=t.meta.arg.id;t.meta.requestId===(null===(r=e[n])||void 0===r?void 0:r.currentRequestId)&&(e[n].completions=t.payload.completions)}).addCase(Zr.rejected,(e,t)=>{e[t.payload.id].error=t.payload}).addCase(dn,(e,t)=>{const{id:r,query:n}=t.payload;r in e&&(e[r].q=n)}).addCase(Gr,(e,t)=>{const{id:r}=t.payload;e[r].q="",e[r].completions=[]}).addCase(Xr,(e,t)=>{e[t.payload.id].completions=[]}).addCase(Kr,(e,t)=>{const{id:r,expression:n}=t.payload;e[r].q=n,e[r].completions=[]}));const hn=xe({},e=>{e.addCase(ln,(e,t)=>{const{id:r,query:n}=t.payload;r in e||(e[r]=n)}).addCase(dn,(e,t)=>{const{id:r,query:n}=t.payload;yn(e,r,n)}).addCase(Kr,(e,t)=>{const{id:r,expression:n}=t.payload;yn(e,r,n)}).addCase(Ir.fulfilled,(e,t)=>{for(const[r,n]of Object.entries(t.payload.querySet))yn(e,r,n)})}),yn=(e,t,r)=>{t in e&&(e[t]=r)};const gn=xe({response:{results:[],searchUid:"",totalCountFiltered:0,facets:[],queryCorrections:[]},duration:0,queryExecuted:"",error:null,automaticallyCorrected:!1},e=>{e.addCase(Nr.rejected,(e,t)=>{e.error=t.payload?t.payload:null}),e.addCase(Nr.fulfilled,(e,t)=>{e.error=null,e.response=t.payload.response,e.queryExecuted=t.payload.queryExecuted,e.duration=t.payload.duration})}),vn=new Fe({required:!0,min:0}),mn=Ee("pagination/registerNumberOfResults",e=>$e(e,vn)),bn=Ee("pagination/updateNumberOfResults",e=>$e(e,vn)),wn=Ee("pagination/registerPage",e=>$e(e,vn)),Sn=Ee("pagination/updatePage",e=>$e(e,vn)),On=Ee("pagination/nextPage"),Cn=Ee("pagination/previousPage");var En=Object.freeze({__proto__:null,registerNumberOfResults:mn,updateNumberOfResults:bn,registerPage:wn,updatePage:Sn,nextPage:On,previousPage:Cn});const xn=xe({firstResult:0,numberOfResults:10,totalCountFiltered:0},e=>{e.addCase(mn,(e,t)=>{const r=An(e),n=t.payload;e.numberOfResults=n,e.firstResult=Pn(r,n)}).addCase(bn,(e,t)=>{e.numberOfResults=t.payload,e.firstResult=0}).addCase(wn,(e,t)=>{const r=t.payload;e.firstResult=Pn(r,e.numberOfResults)}).addCase(Sn,(e,t)=>{const r=t.payload;e.firstResult=Pn(r,e.numberOfResults)}).addCase(Cn,e=>{const t=An(e),r=Math.max(t-1,1);e.firstResult=Pn(r,e.numberOfResults)}).addCase(On,e=>{const t=An(e),r=function(e){const{totalCountFiltered:t,numberOfResults:r}=e;return jn(t,r)}(e),n=Math.min(t+1,r);e.firstResult=Pn(n,e.numberOfResults)}).addCase(Ir.fulfilled,(e,t)=>{e.numberOfResults=t.payload.pagination.numberOfResults,e.firstResult=t.payload.pagination.firstResult}).addCase(Nr.fulfilled,(e,t)=>{const{response:r}=t.payload;e.totalCountFiltered=r.totalCountFiltered})});function An(e){const{firstResult:t,numberOfResults:r}=e;return In(t,r)}function Pn(e,t){return(e-1)*t}function In(e,t){return e/t+1}function jn(e,t){const r=Math.min(e,1e3);return Math.ceil(r/t)}const qn={expression:new Be({required:!0,emptyAllowed:!1})},Rn=Ee("sortCriteria/register",e=>Le(e,qn)),Tn=Ee("sortCriteria/update",e=>Le(e,qn));var _n=Object.freeze({__proto__:null,registerSortCriterion:Rn,updateSortCriterion:Tn});function kn(){return{expression:"relevancy"}}function Fn(){return{expression:"qre"}}function Vn(){return{expression:"nosort"}}function Mn(e){return{expression:"date "+e}}function Dn(e,t){return{expression:`@${e} ${t}`}}function Un(e){return{expression:e.map(e=>e.expression).join(",")}}const Nn=xe("relevancy",e=>{e.addCase(Rn,(e,t)=>t.payload.expression).addCase(Tn,(e,t)=>t.payload.expression).addCase(Ir.fulfilled,(e,t)=>t.payload.sortCriteria)}),Bn=Ee("facet/register"),zn=Ee("facet/selectValue"),Hn=Ee("facet/deselectAll"),Ln=Ee("facet/updateSortCriterion"),$n=Ee("facet/updateNumberOfValues");var Qn=Object.freeze({__proto__:null,registerFacet:Bn,toggleSelectFacetValue:zn,deselectAllFacetValues:Hn,updateFacetSortCriterion:Ln,updateFacetNumberOfValues:$n});const Yn=je("analytics/facet/showMore",async(e,{getState:t})=>{const r=gr(t),n=to(e,r);return await yr(r).logFacetShowMore(n),mr()}),Wn=je("analytics/facet/showLess",async(e,{getState:t})=>{const r=gr(t),n=to(e,r);return await yr(r).logFacetShowLess(n),mr()}),Jn=je("analytics/facet/search",async(e,{getState:t})=>{const r=gr(t),n=to(e,r);return await yr(r).logFacetSearch(n),mr()}),Kn=je("analytics/facet/sortChange",async(e,{getState:t})=>{const{facetId:r,criterion:n}=e,o=gr(t),i={...to(r,o),criteria:n};return await yr(o).logFacetUpdateSort(i),mr()}),Gn=je("analytics/facet/reset",async(e,{getState:t})=>{const r=gr(t),n=to(e,r);return await yr(r).logFacetClearAll(n),mr()}),Xn=je("analytics/facet/select",async(e,{getState:t})=>{const r=gr(t),n=eo(e,r);return await yr(r).logFacetSelect(n),mr()}),Zn=je("analytics/facet/deselect",async(e,{getState:t})=>{const r=gr(t),n=eo(e,r);return await yr(r).logFacetDeselect(n),mr()});function eo(e,t){const{facetId:r,facetValue:n}=e;return{...to(r,t),facetValue:n}}function to(e,t){const r=t.facetSet[e].field;return{facetId:e,facetField:r,facetTitle:`${r}_${e}`}}const ro=Ee("facetSearch/register"),no=Ee("facetSearch/update"),oo=je("facetSearch/executeSearch",async(e,{dispatch:t,getState:r})=>{const n=r(),o=await pt.facetSearch(e,n);return t(Jn(e)),{facetId:e,response:o}}),io=Ee("facetSearch/selectValue");const ao=xe({},e=>{e.addCase(Bn,(e,t)=>{const{facetId:r}=t.payload;var n;r in e||(e[r]=(n=t.payload,{type:"specific",currentValues:[],delimitingCharacter:">",filterFacetCount:!0,freezeCurrentValues:!1,injectionDepth:1e3,isFieldExpanded:!1,numberOfValues:8,preventAutoSelect:!1,sortCriteria:"score",...n}))}).addCase(Ir.fulfilled,(e,t)=>{if(0!==Object.keys(t.payload.facetSet).length)return t.payload.facetSet}).addCase(zn,(e,t)=>{const{facetId:r,selection:n}=t.payload,o=e[r];if(!o)return;const i=o.currentValues.find(e=>e.value===n.value);if(!i)return;const a="selected"===i.state;i.state=a?"idle":"selected",o.freezeCurrentValues=!0,o.preventAutoSelect=!0}).addCase(Hn,(e,t)=>{const r=e[t.payload];r&&(r.currentValues.forEach(e=>e.state="idle"),r.preventAutoSelect=!0)}).addCase(Ln,(e,t)=>{const{facetId:r,criterion:n}=t.payload,o=e[r];o&&(o.sortCriteria=n)}).addCase($n,(e,t)=>{const{facetId:r,numberOfValues:n}=t.payload,o=e[r];o&&(o.numberOfValues=n)}).addCase(Nr.fulfilled,(e,t)=>{t.payload.response.facets.forEach(t=>{const r=t.facetId,n=e[r];n&&(n.currentValues=t.values.map(so),n.freezeCurrentValues=!1,n.preventAutoSelect=!1)})}).addCase(io,(e,t)=>{const{facetId:r,value:n}=t.payload,o=e[r];if(!o)return;const{rawValue:i}=n;if(o.currentValues.filter(e=>e.value===i).length)return;const a={value:i,state:"selected"};o.currentValues.push(a)})});function so(e){const{value:t,state:r}=e;return{value:t,state:r}}const co=new Be({required:!0,emptyAllowed:!1}),uo=new He({each:co,required:!0}),lo=(e,t)=>($e(e,co),ze(t)?$e(t,co):$e(t,uo),{payload:{contextKey:e,contextValue:t}}),fo=Ee("context/set",e=>{for(const[t,r]of Object.entries(e))lo(t,r);return{payload:e}}),po=Ee("context/add",e=>lo(e.contextKey,e.contextValue)),ho=Ee("context/remove",e=>$e(e,co));const yo=xe({contextValues:{}},e=>{e.addCase(fo,(e,t)=>{e.contextValues=t.payload}).addCase(po,(e,t)=>{e.contextValues[t.payload.contextKey]=t.payload.contextValue}).addCase(ho,(e,t)=>{delete e.contextValues[t.payload]}).addCase(Ir.fulfilled,(e,t)=>{e.contextValues=t.payload.context.contextValues})}),go=Ee("pipeline/set",e=>$e(e,new Be({required:!0,emptyAllowed:!0})));var vo=Object.freeze({__proto__:null,setPipeline:go});const mo=xe("",e=>{e.addCase(go,(e,t)=>t.payload).addCase(Ir.fulfilled,(e,t)=>t.payload.pipeline).addCase(Ye,(e,t)=>t.payload.pipeline)}),bo=Ee("dateFacet/register"),wo=Ee("dateFacet/selectValue");function So(e,t){const{facetId:r}=t;r in e||(e[r]=t)}function Oo(e,t,r){const n=e[t];if(!n)return;const o=function(e,t){const{start:r,end:n,endInclusive:o}=t;return e.find(e=>e.start===r&&e.end===n&&e.endInclusive===o)}(n.currentValues,r);if(!o)return;const i="selected"===o.state;o.state=i?"idle":"selected",n.preventAutoSelect=!0}function Co(e,t,r){t.forEach(t=>{const n=t.facetId,o=e[n];if(!o)return;const i=r(t.values);o.currentValues=i,o.preventAutoSelect=!1})}const Eo=xe({},e=>{e.addCase(bo,(e,t)=>{const{payload:r}=t;var n;So(e,(n=r,{currentValues:[],preventAutoSelect:!1,filterFacetCount:!1,injectionDepth:1e3,numberOfValues:8,sortCriteria:"ascending",type:"dateRange",...n}))}).addCase(Ir.fulfilled,(e,t)=>t.payload.dateFacetSet).addCase(wo,(e,t)=>{const{facetId:r,selection:n}=t.payload;Oo(e,r,n)}).addCase(Nr.fulfilled,(e,t)=>{Co(e,t.payload.response.facets,xo)})});function xo(e){return e.map(e=>{const{numberOfResults:t,...r}=e;return r})}const Ao=Ee("numericFacet/register"),Po=Ee("numericFacet/selectValue");var Io=Object.freeze({__proto__:null,registerNumericFacet:Ao,toggleSelectNumericFacetValue:Po});const jo=xe({},e=>{e.addCase(Ao,(e,t)=>{const{payload:r}=t;var n;So(e,(n=r,{currentValues:[],preventAutoSelect:!1,filterFacetCount:!1,injectionDepth:1e3,numberOfValues:8,sortCriteria:"ascending",type:"numericalRange",...n}))}).addCase(Ir.fulfilled,(e,t)=>t.payload.numericFacetSet).addCase(Po,(e,t)=>{const{facetId:r,selection:n}=t.payload;Oo(e,r,n)}).addCase(Nr.fulfilled,(e,t)=>{Co(e,t.payload.response.facets,qo)})});function qo(e){return e.map(e=>{const{numberOfResults:t,...r}=e;return r})}const Ro=Ee("searchHub/set",e=>$e(e,new Be({required:!0,emptyAllowed:!0})));var To=Object.freeze({__proto__:null,setSearchHub:Ro});const _o=xe("",e=>{e.addCase(Ro,(e,t)=>t.payload).addCase(Ir.fulfilled,(e,t)=>t.payload.searchHub).addCase(Ye,(e,t)=>t.payload.searchHub)}),ko=xe({context:{contextValues:{}},facetSet:{},dateFacetSet:{},numericFacetSet:{},pagination:{firstResult:0,numberOfResults:10,totalCountFiltered:0},query:{q:""},sortCriteria:"relevancy",querySet:{},pipeline:"",searchHub:""},e=>{e.addCase(xr,(e,t)=>Fo(e,t.payload)?void 0:t.payload)}),Fo=(e,t)=>Vo(e.context,t.context)&&Mo(e.facetSet,t.facetSet)&&Do(e.dateFacetSet,t.dateFacetSet)&&Uo(e.numericFacetSet,t.numericFacetSet)&&No(e.pagination,t.pagination)&&Bo(e.query,t.query)&&zo(e,t)&&Ho(e.pipeline,t.pipeline)&&Lo(e.searchHub,t.searchHub),Vo=(e,t)=>JSON.stringify(e.contextValues)===JSON.stringify(t.contextValues),Mo=(e,t)=>JSON.stringify(e)===JSON.stringify(t),Do=(e,t)=>JSON.stringify(e)===JSON.stringify(t),Uo=(e,t)=>JSON.stringify(e)===JSON.stringify(t),No=(e,t)=>e.firstResult===t.firstResult&&e.numberOfResults===t.numberOfResults,Bo=(e,t)=>e.q===t.q,zo=(e,t)=>e.sortCriteria===t.sortCriteria,Ho=(e,t)=>e===t,Lo=(e,t)=>e===t;const $o=xe({enableDidYouMean:!1,wasCorrectedTo:"",wasAutomaticallyCorrected:!1,queryCorrection:{correctedQuery:"",wordCorrections:[]}},e=>{e.addCase(kr,e=>{e.enableDidYouMean=!0}).addCase(Fr,e=>{e.enableDidYouMean=!1}).addCase(Nr.pending,e=>{e.queryCorrection={correctedQuery:"",wordCorrections:[]},e.wasAutomaticallyCorrected=!1,e.wasCorrectedTo=""}).addCase(Nr.fulfilled,(e,t)=>{e.queryCorrection=t.payload.response.queryCorrections[0]||{correctedQuery:"",wordCorrections:[]},e.wasAutomaticallyCorrected=t.payload.automaticallyCorrected}).addCase(Vr,(e,t)=>{e.wasCorrectedTo=t.payload})});const Qo=xe({},e=>{e.addCase(ro,(e,t)=>{const r=t.payload,{facetId:n}=r;if(e[n])return;const o=Yo(r);e[n]=function(e={}){return{options:Yo(),response:{moreValuesAvailable:!1,values:[]},...e}}({options:o})}).addCase(no,(e,t)=>{const{facetId:r,...n}=t.payload,o=e[r];o&&(o.options={...o.options,...n})}).addCase(oo.fulfilled,(e,t)=>{const{facetId:r,response:n}=t.payload,o=e[r];o&&(o.response=n)})});function Yo(e={}){return{captions:{},numberOfValues:10,query:"",...e}}const Wo=new He({each:new Be({required:!0,emptyAllowed:!1}),required:!0}),Jo=Ee("fields/registerFieldsToInclude",e=>$e(e,Wo)),Ko=xe({fieldsToInclude:["author","language","urihash","objecttype","collection","source","permanentid"]},e=>e.addCase(Jo,(e,t)=>{e.fieldsToInclude=[...new Set(e.fieldsToInclude.concat(t.payload))]})),Go={configuration:rn,facetSet:ao,dateFacetSet:Eo,numericFacetSet:jo,facetSearchSet:Qo,query:tn,querySet:hn,pagination:xn,redirection:cn,querySuggest:pn,search:gn,sortCriteria:Nn,context:yo,history:((e,t)=>{const r=wt(t);return(t=r,n)=>{switch(n.type){case mt:return(e=>{const{past:t,present:r,future:n}=e;if(0===t.length)return e;const o=t[t.length-1];return{past:t.slice(0,t.length-1),present:o,future:[r,...n]}})(t);case bt:return(e=>{const{past:t,present:r,future:n}=e;if(0===n.length)return e;return{past:[...t,r],present:n[0],future:n.slice(1)}})(t);default:return((e,t,r,n)=>{const{past:o,present:i}=e,a=r(i,n);return a===t.present||i===a?e:i===t.present?wt(a):{past:[...o,i],present:a,future:[]}})(t,r,e,n)}}})(ko,{context:{contextValues:{}},facetSet:{},dateFacetSet:{},numericFacetSet:{},pagination:{firstResult:0,numberOfResults:10,totalCountFiltered:0},query:{q:""},sortCriteria:"relevancy",querySet:{},pipeline:"",searchHub:""}),didYouMean:$o,fields:Ko,pipeline:mo,searchHub:_o};class Xo{constructor(e){this.engine=e}subscribe(e){return e(),this.engine.subscribe(()=>e())}get dispatch(){return this.engine.dispatch}}function Zo(e){return{subscribe:t=>(t(),e.subscribe(()=>t()))}}const ei=(e,t=5)=>e+Math.random().toString(36).substr(2,2+t);const ti=je("analytics/trigger/redirection",async(e,{getState:t})=>{const r=gr(t);return null!==r.redirection.redirectTo&&await yr(r).logTriggerRedirect({redirectedTo:r.redirection.redirectTo}),mr()}),ri=je("analytics/searchbox/submit",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logSearchboxSubmit(),mr()}),ni=new Re({id:new Be({default:()=>ei("search_box"),emptyAllowed:!1}),numberOfSuggestions:new Fe({default:5,min:0}),isStandalone:new Me({default:!1})}),oi=(e,t={})=>{const r=Zo(e),{dispatch:n}=e,o=ni.validate(t.options);return n(ln({id:o.id,query:""})),n(Wr({id:o.id,q:e.state.query.q,count:o.numberOfSuggestions})),{...r,get id(){return o.id},updateText(e){n(dn({id:o.id,query:e})),o.numberOfSuggestions&&this.showSuggestions()},clear(){n(Gr({id:o.id}))},hideSuggestions(){n(Xr({id:o.id}))},showSuggestions(){n(Zr({id:o.id}))},selectSuggestion(e){n(Kr({id:o.id,expression:e})),this.submit()},submit(){n(Mr({q:this.state.value})),n(Sn(1)),o.isStandalone?n(an()).then(()=>n(ti())):n(Nr(ri()))},get state(){const t=e.state,r=t.querySuggest[o.id];return{value:t.querySet[o.id],suggestions:r.completions.map(e=>({value:e.expression})),redirectTo:t.redirection.redirectTo}}}};function ii(e){return e.pagination.numberOfResults}const ai=de((function(e){return e.pagination.firstResult}),ii,In),si=de((function(e){return e.pagination.totalCountFiltered}),ii,jn),ci=de(ai,si,(e,t)=>t,(e,t,r)=>{let n=function(e,t){const r=t%2==0,n=Math.floor(t/2);return{start:e-n,end:e+(r?n-1:n)}}(e,r);return n=function(e){const t=Math.max(1-e.start,0),r=e.start+t,n=e.end+t;return{start:r,end:n}}(n),n=function(e,t){const r=Math.max(e.end-t,0),n=Math.max(e.start-r,1),o=e.end-r;return{start:n,end:o}}(n,t),function(e){const t=[];for(let r=e.start;r<=e.end;++r)t.push(r);return t}(n)});const ui=je("analytics/pager/resize",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logPagerResize({currentResultsPerPage:r.pagination.numberOfResults}),mr()}),li=je("analytics/pager/number",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logPagerNumber({pagerNumber:ai(r)}),mr()}),di=je("analytics/pager/next",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logPagerNext({pagerNumber:ai(r)}),mr()}),fi=je("analytics/pager/previous",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logPagerPrevious({pagerNumber:ai(r)}),mr()}),pi=new Re({numberOfPages:new Fe({default:5,min:0})}),hi=(e,t={})=>{var r;const n=Zo(e),{dispatch:o}=e,i=pi.validate(t.options),a=null===(r=t.initialState)||void 0===r?void 0:r.page;a&&o(wn(a));const s=()=>ai(e.state),c=()=>{const{numberOfPages:t}=i;return ci(e.state,t)},u=()=>si(e.state);return{...n,get state(){return{currentPage:s(),currentPages:c(),maxPage:u()}},get currentPages(){return c()},get currentPage(){return s()},get maxPage(){return u()},get hasPreviousPage(){const{currentPage:e,maxPage:t}=this.state;return e>1&&t>0},get hasNextPage(){const{currentPage:e,maxPage:t}=this.state;return e<t},selectPage(e){o(Sn(e)),o(Nr(li()))},nextPage(){o(On()),o(Nr(di()))},previousPage(){o(Cn()),o(Nr(fi()))},isCurrentPage(e){return e===this.state.currentPage}}},yi=e=>({...Zo(e),get state(){return{results:e.state.search.response.results}}}),gi=(e,t={})=>{var r;const n=Zo(e),{dispatch:o}=e,i=null===(r=t.initialState)||void 0===r?void 0:r.numberOfResults;return void 0!==i&&o(mn(i)),{...n,get state(){return{numberOfResults:e.state.pagination.numberOfResults}},set(e){o(bn(e)),o(Nr(ui()))},isSetTo(e){return e===this.state.numberOfResults}}},vi=je("analytics/sort/results",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logResultsSort({resultsSortBy:r.sortCriteria}),mr()});class mi extends Xo{constructor(e,t={}){super(e),this.props=t,this.register()}sortBy(e){this.dispatch(Tn(e)),this.dispatch(Sn(1)),this.search()}isSortedBy(e){return this.engine.state.sortCriteria===e.expression}get state(){return{sortCriteria:this.engine.state.sortCriteria}}register(){var e;const t=null===(e=this.props.initialState)||void 0===e?void 0:e.criterion;t&&this.dispatch(Rn(t))}search(){this.dispatch(Nr(vi()))}}const bi=e=>{const t=Zo(e),r=()=>{const t=e.state.search.duration/1e3;return Math.round(100*(t+Number.EPSILON))/100};return{...t,get state(){const t=e.state;return{firstResult:t.pagination.firstResult+1,lastResult:t.pagination.firstResult+t.search.response.results.length,total:t.pagination.totalCountFiltered,query:t.search.queryExecuted,hasQuery:""!==t.search.queryExecuted,hasDuration:0!==t.search.duration,hasResults:0!==t.search.response.results.length,durationInMilliseconds:t.search.duration,durationInSeconds:r()}}}},wi=(e,t)=>e.search.response.facets.find(e=>e.facetId===t),Si=(e,t)=>e.facetSet[t];const Oi=new Re({facetId:new Be({default:()=>ei("facet")}),field:new Be({required:!0}),delimitingCharacter:new Be({default:">"}),filterFacetCount:new Me({default:!0}),injectionDepth:new Fe({default:1e3}),numberOfValues:new Fe({default:8,min:1})});function Ci(e,t){const r=Zo(e),n=Oi.validate(t.options),o=e.dispatch,i=()=>{const t=n.facetId,r=e.state;return Si(r,t)},a=()=>{const t=n.facetId,r=e.state;return wi(r,t)},s=e=>"selected"===e.state;return o(Bn(n)),{...r,facetSearch:(()=>{const{facetId:t,facetSearch:r}=n,o={facetId:t,...r};return function(e,t){const r=e.dispatch,n=t.options.facetId;return r(ro(t.options)),{updateText(e){r(no({facetId:n,query:`*${e}*`}))},search(){r(oo(n))},select(e){r(io({facetId:n,value:e})),r(Nr(Xn({facetId:n,facetValue:e.rawValue})))},get state(){return{...e.state.facetSearchSet[n].response}}}}(e,{options:o})})(),toggleSelect(e){const t=n.facetId,r=(e=>{const t={facetId:n.facetId,facetValue:e.value};return s(e)?Zn(t):Xn(t)})(e);o(zn({facetId:t,selection:e})),o(Nr(r))},isValueSelected:s,deselectAll(){const e=n.facetId;o(Hn(e)),o(Nr(Gn(e)))},get hasActiveValues(){return this.state.values.some(e=>"idle"!==e.state)},sortBy(e){const t=n.facetId;o(Ln({facetId:t,criterion:e})),o(Nr(Kn({facetId:t,criterion:e})))},isSortedBy(e){return this.state.sortCriterion===e},showMoreValues(){const e=n.facetId,t=i().numberOfValues,r=n.numberOfValues;o($n({facetId:e,numberOfValues:t+(r-t%r)})),o(Ln({facetId:e,criterion:"alphanumeric"})),o(Nr(Yn(e)))},get canShowMoreValues(){const e=a();return!!e&&e.moreValuesAvailable},showLessValues(){const{facetId:e,numberOfValues:t}=n,r=Math.max(t,(()=>{const{currentValues:e}=i();return e.filter(e=>"idle"!==e.state).length})());o($n({facetId:e,numberOfValues:r})),o(Ln({facetId:e,criterion:"score"})),o(Nr(Wn(e)))},get canShowLessValues(){const{currentValues:e}=i(),t=n.numberOfValues,r=!!e.find(e=>"idle"===e.state);return t<e.length&&r},get state(){const e=i(),t=a(),r=e.sortCriteria;return{values:t?t.values:[],sortCriterion:r}}}}const Ei=e=>{const t=Zo(e),{dispatch:r}=e;return{...t,get state(){return{values:e.state.context.contextValues}},set(e){r(fo(e))},add(e,t){r(po({contextKey:e,contextValue:t}))},remove(e){r(ho(e))}}},xi=e=>({...Zo(e),get state(){return{hasError:null!==e.state.search.error,error:e.state.search.error}}}),Ai=e=>{const t=Zo(e),{dispatch:r}=e;return{...t,get state(){return e.state.history},async back(){await r(Ar()),r(Nr(qr()))},async forward(){await r(Pr()),r(Nr(jr()))}}},Pi=e=>{const t=Zo(e),{dispatch:r}=e;return r(kr()),{...t,get state(){const t=e.state;return{...t.didYouMean,hasQueryCorrection:""!==t.didYouMean.queryCorrection.correctedQuery||""!==t.didYouMean.wasCorrectedTo}},applyCorrection(){r(Vr(this.state.queryCorrection.correctedQuery)),r(Nr(Tr()))}}};function Ii(e){return{endInclusive:!1,state:"idle",...e}}function ji(e,t){const r=Zo(e),n=e.dispatch,o=t.options.facetId||ei("numericFacet"),i={facetId:o,...t.options},a=e=>"selected"===e.state;return n(Ao(i)),{...r,toggleSelect(e){const t=(e=>{const{start:t,end:r}=e,n={facetId:o,facetValue:`${t}..${r}`};return a(e)?Zn(n):Xn(n)})(e);n(Po({facetId:o,selection:e})),n(Nr(t))},isValueSelected:a,get state(){const t=wi(e.state,o);return{values:t?t.values:[]}}}}const qi=je("analytics/result/open",async(e,{getState:t})=>{const r=gr(t);return await yr(r).logDocumentOpen(Or(e,r),Cr(e)),br()});var Ri=Object.freeze({__proto__:null,logDocumentOpen:qi});const Ti=new Re({priority:new Fe({required:!1,default:0,min:0})});class _i{constructor(e){this.engine=e,this.templates=[]}registerTemplates(...e){this.validateTemplates(e),e.forEach(e=>{const t={...e,priority:e.priority||0,fields:e.fields||[]};this.templates.push(t)}),this.templates.sort((e,t)=>t.priority-e.priority),this.engine.dispatch(Jo([]))}validateTemplates(e){e.forEach(e=>{Ti.validate(e);if(!e.conditions.every(e=>e instanceof Function))throw new Error("Result template conditions are invalid")})}selectTemplate(e){const t=this.templates.find(t=>t.conditions.every(t=>t(e)));return t?t.content:null}}const ki=(e,t)=>{const r=t.raw[e];return n=r,Array.isArray(n)?r:[r];var n};var Fi=Object.freeze({__proto__:null,fieldMustMatch:(e,t)=>r=>{const n=ki(e,r);return t.some(e=>n.some(t=>(""+t).toLowerCase()===e.toLowerCase()))},fieldMustNotMatch:(e,t)=>r=>{const n=ki(e,r);return t.every(e=>n.every(t=>(""+t).toLowerCase()!==e.toLowerCase()))}});function Vi(e={}){return{configuration:{organizationId:"",accessToken:"",search:{searchApiBaseUrl:"https://globalplatform.cloud.coveo.com/rest/search"},analyticsEnabled:!0},facetSet:{},dateFacetSet:{},numericFacetSet:{},facetSearchSet:{},pagination:{firstResult:0,numberOfResults:10,totalCountFiltered:0},query:{q:""},querySet:{},querySuggest:{},redirection:{redirectTo:null},search:{response:{results:[],searchUid:"",totalCountFiltered:0,facets:[],queryCorrections:[]},duration:0,queryExecuted:"",error:null,automaticallyCorrected:!1},sortCriteria:"relevancy",context:{contextValues:{}},didYouMean:{enableDidYouMean:!1,wasCorrectedTo:"",wasAutomaticallyCorrected:!1,queryCorrection:{correctedQuery:"",wordCorrections:[]}},fields:{fieldsToInclude:["author","language","urihash","objecttype","collection","source","permanentid"]},history:wt({context:{contextValues:{}},facetSet:{},dateFacetSet:{},numericFacetSet:{},pagination:{firstResult:0,numberOfResults:10,totalCountFiltered:0},query:{q:""},sortCriteria:"relevancy",querySet:{},pipeline:"",searchHub:""}),pipeline:"",searchHub:"",...e}}var Mi,Di,Ui=Function.prototype,Ni=Object.prototype,Bi=Ui.toString,zi=Ni.hasOwnProperty,Hi=Bi.call(Object),Li=Ni.toString,$i=(Mi=Object.getPrototypeOf,Di=Object,function(e){return Mi(Di(e))});var Qi=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=Li.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=$i(e);if(null===t)return!0;var r=zi.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Bi.call(r)==Hi},Yi=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Ze((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function r(){var e=[],r=[];return{getState:function(){return i(t)?t(e):t},getActions:function(){return e},dispatch:function(t){if(!(0,n.default)(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant? Action: '+JSON.stringify(t));e.push(t);for(var o=0;o<r.length;o++)r[o]();return t},clearActions:function(){e=[]},subscribe:function(e){return i(e)&&r.push(e),function(){var t=r.indexOf(e);t<0||r.splice(t,1)}},replaceReducer:function(e){if(!i(e))throw new Error("Expected the nextReducer to be a function.")}}}var a=se.applyMiddleware.apply(void 0,o(e))(r);return a()}};var r,n=(r=Qi)&&r.__esModule?r:{default:r};function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=function(e){return"function"==typeof e}})));const Wi=()=>Yi([$r,pe,...Oe()]);function Ji(e={}){return{urihash:"",parents:"",sfid:"",sfparentid:"",sfinsertedbyid:"",documenttype:"",sfcreatedbyid:"",permanentid:"",date:0,objecttype:"",sourcetype:"",sftitle:"",size:0,sffeeditemid:"",clickableuri:"",sfcreatedby:"",source:"",collection:"",connectortype:"",filetype:"",sfcreatedbyname:"",sflikecount:0,language:[],...e}}var Ki=Object.freeze({__proto__:null,buildMockEngine:function(e={}){const t=Wi()(e.state||Vi()),r=()=>{};return{store:t,state:Vi(),subscribe:jest.fn(()=>r),get dispatch(){return t.dispatch},get actions(){return t.getActions()},...e}},createMockState:Vi,buildMockResult:function(e={}){return{title:"",uri:"",printableUri:"",clickUri:"",uniqueId:"",excerpt:"",firstSentences:"",summary:null,flags:"",hasHtmlVersion:!1,hasMobileHtmlVersion:!1,score:0,percentScore:0,rankingInfo:null,rating:0,isTopResult:!1,isRecommendation:!1,isUserActionView:!1,titleHighlights:[],firstSentencesHighlights:[],excerptHighlights:[],printableUriHighlights:[],summaryHighlights:[],parentResult:null,childResults:[],totalNumberOfChildResults:0,absentTerms:[],raw:Ji(),Title:"",Uri:"",PrintableUri:"",ClickUri:"",UniqueId:"",Excerpt:"",FirstSentences:"",...e}},buildMockRaw:Ji});export{Xo as Controller,Qr as HeadlessEngine,Ri as ResultAnalyticsActions,_i as ResultTemplatesManager,mi as Sort,Ki as TestUtils,Er as analyticsActions,Un as buildCompositeSortCriterion,Ei as buildContext,Zo as buildController,Mn as buildDateSortCriterion,Pi as buildDidYouMean,Ci as buildFacet,Dn as buildFieldSortCriterion,Ai as buildHistory,Vn as buildNoSortCriterion,ji as buildNumericFacet,Ii as buildNumericRange,hi as buildPager,xi as buildQueryError,Fn as buildQueryRankingExpressionSortCriterion,bi as buildQuerySummary,kn as buildRelevanceSortCriterion,yi as buildResultList,gi as buildResultsPerPage,oi as buildSearchBox,Ge as configurationActions,Ee as createAction,je as createAsyncThunk,xe as createReducer,ai as currentPageSelector,ci as currentPagesSelector,Qn as facetActions,Si as facetRequestSelector,wi as facetSelector,Rr as historyActions,si as maxPageSelector,Io as numericFacetActions,En as paginationActions,vo as pipelineActions,Dr as queryActions,fn as querySetActions,en as querySuggestActions,sn as redirectionActions,Fi as resultTemplatesHelpers,Lr as searchActions,To as searchHubActions,Go as searchPageReducers,_n as sortCriterionActions};
//# sourceMappingURL=headless.esm.js.map
